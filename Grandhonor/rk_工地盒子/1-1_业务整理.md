## 快速笔记

+ 查看解码CPU利用率
  + 进程名: r|listen 
  + 进程ID：1293

## 需求

+ 算法
  - 安全帽检测
  - 反光衣检测
  - 区域入侵
  - 烟火检测

+ 业务
  - 四路，4fps
  - 轮询
  - 任务配置
  - 画区域

## 任务分割

+ 当前主要任务：
  - 搞清楚任务管理界面，轮询功能的业务逻辑

### 轮询业务

+ 环境
  - 创建一个轮询任务，必须要绑定至少两个算法，当前绑定算法为 安全帽检测 和 区域入侵检测。
  - 配置可选项为 算法运行时间，目前都配置三分钟
  - 当前配置的摄像头为 ： rtsp://192.169.4.16/test-phone-Helmet.mp4

+ 现象
  + 安全帽
    + 第一次告警，时间：2023-05-22 17:59:20 ；
    + 随后，持续告警安全帽，最后一次告警，时间： 2023-05-22 18:02:02；
  + 区域入侵
    + 第一次告警，时间：2023-05-22 18:02:27
    + 随后，持续告警区域入侵，最后一次告警，时间：2023-05-22 18:05:13
  + 接下来，重复安全帽检测
    + 第一次告警，时间：2023-05-22 18:05:20
    + 随后，持续告警安全帽，最后一次告警，时间：2023-05-22 18:08:05
  + 接下来，重复区域入侵检测
    + 第一次告警，时间：2023-05-22 18:08:21
    + 随后，持续告警区域入侵，最后一次告警，时间：2023-05-22 18:11:12

+ 结论一
  + 轮询启用，一个任务，一个视频流，配置多个算法，每个算法配置运行时间，相当于配置运行的时间片
  + 任务启动后，从当前时间开始计时，执行绑定的第一个检测算法，运行时间为该算法所配置的运行时间，达到运行时间后，启用绑定的下一个检测算法，同时开始计时
  + 重复以上步骤

+ 推论一
  + 类似于时间片轮转调度算法，一个拉取了视频流的任务相当于一个CPU资源，每一个算法相当于一个进程，在配置时，给每个算法配置 算法运行时间，相当于给每个进程分配一个固定大小的时间片，这些算法存放在一个队列中，规则为FIFO
  + 取队列头部的算法使用，当这个算法在任务上生效时，相当于这个算法独占了这个任务（视频流资源），在内部启动一个计时器，当时间片用完时，这个算法让出任务（视频流资源），放到队列尾部，等待下一次使用
  + 下一个算法为队列头部的算法，其占用任务（视频流资源），同时其内存启动该任务的计时器，当该任务的时间片用完时，也让出任务（视频流资源），下一个算法占用，以此类推

### 阶段启用业务

+ 环境
  - 创建一个阶段启用任务，可以绑定多个算法
  - 需要配置的选项为 算法运行开始时间 和 算法运行结束时间
    - 安全帽配置的算法运行开始时间为 19:40, 算法运行结束时间为 19:45
    - 区域入侵配置的算法运行开始时间为 19:50, 算法运行结束时间为 19:55
  - 配置的算法阶段启用时间段不能重合，一点都不能重合，是串行的
  - 当前配置的摄像头为：rtsp://192.169.4.16/test-phone-Helmet.mp4

+ 现象
  + 创建任务后，不会立即显示视频流，等到19:40才会有视频流显示，同时会有安全帽的告警时间产生；时间到19:45后，视频流不再显示，同时安全帽的告警时间也不产生
  + 等到时间到19:50，视频流再次显示，同时区域入侵的告警事件产生；时间到19:55后，视频流不再显示，同时告警也不再显示

+ 结论一
  + 阶段启用任务，一个任务，一个视频流，配置多个算法，每个算法配置启用的时间 和 结束的时间，这个时间的单位是小时和分钟，意味着如果不停止任务，每天的配置时间内会启动检测，

+ 推论一
  + 类似于比特大陆盒子上的设置任务有效时间，只不过这个启动和停止是任务方面的，到时间了启动任务，超过了时间段，就停止任务，第二天同一时间再启动和停止任务