---
category: Qt
date: 2024-09-05 09:00:00 +0800
layout: post
title: qt_3_常见类型
tag: Qt
---
## 简介

+ Qt 中常见的数据类型及其笔记

## Qt QVector 详解

`QVector` 是 Qt 框架中用于存储相同类型元素的动态数组类，类似于 C++ 标准库的 `std::vector`。它提供了许多方便的接口来进行动态分配、访问和操作数据。下面是对 `QVector` 的详解。

### 1. **基本概念**
`QVector<T>` 是一个模板类，`T` 是其中元素的类型。`QVector` 可以根据需要动态调整数组的大小，支持类似数组的下标访问方式，并且性能表现与 `std::vector` 类似。

```cpp
QVector<int> intVector;  // 创建一个存储整数的 QVector
```

### 2. **常用操作**

#### 2.1 **初始化**
`QVector` 支持多种初始化方式，包括默认构造、指定大小的构造、和使用初始值的构造等。

```cpp
QVector<int> vec1;  // 默认构造，空向量
QVector<int> vec2(5);  // 构造一个包含5个默认初始化元素的向量
QVector<int> vec3(5, 10);  // 构造一个包含5个元素，每个元素初始化为10
```

#### 2.2 **访问元素**
可以通过下标访问或者使用 `at()` 函数。

```cpp
int first = vec3[0];  // 使用下标访问
int second = vec3.at(1);  // 使用 at() 方法访问
```

#### 2.3 **添加元素**
可以通过 `append()` 和 `push_back()` 方法向向量末尾添加元素。`insert()` 方法可以在特定位置插入元素。

```cpp
vec1.append(3);      // 向尾部添加元素
vec1.push_back(5);   // 与 append 类似，添加到末尾
vec1.insert(1, 4);   // 在索引 1 处插入元素
```

#### 2.4 **删除元素**
可以使用 `remove()`, `removeAt()`, `removeFirst()`, `removeLast()` 等函数来删除元素。

```cpp
vec1.removeAt(0);    // 删除索引为 0 的元素
vec1.removeFirst();  // 删除第一个元素
vec1.removeLast();   // 删除最后一个元素
```

#### 2.5 **查找和判断**
`QVector` 提供 `contains()` 来判断是否包含某元素，`indexOf()` 和 `lastIndexOf()` 用于查找某个元素的索引。

```cpp
bool hasValue = vec1.contains(5);  // 判断是否包含 5
int index = vec1.indexOf(5);       // 查找 5 的位置
```

#### 2.6 **大小和容量**
`QVector` 动态调整大小，可以通过 `size()` 获取当前元素的数量，通过 `capacity()` 获取预分配的内存容量。可以通过 `resize()` 改变 `QVector` 的大小。

```cpp
int size = vec1.size();       // 获取当前元素数量
int capacity = vec1.capacity(); // 获取当前容量
vec1.resize(10);              // 改变大小为10，可能会填充新元素
```

### 3. **迭代**
支持 C++ 范围循环（range-based for loop）和迭代器。

```cpp
for (int value : vec1) {
    qDebug() << value;
}

QVector<int>::iterator it;
for (it = vec1.begin(); it != vec1.end(); ++it) {
    qDebug() << *it;
}
```

### 4. **性能**
- **内存管理**：`QVector` 会动态调整内存，避免频繁的内存分配。通常，`capacity()` 比 `size()` 大，以减少内存重新分配的次数。
- **浅拷贝优化（Copy-on-Write）**：`QVector` 使用 Qt 的隐式共享机制，也称为浅拷贝。当一个 `QVector` 被复制时，实际上并不会立即进行数据复制，直到修改操作发生，这提高了性能。

### 5. **与其他容器的互操作**
`QVector` 提供了与其他容器（如 `QList`, `QSet`）的互操作能力，可以方便地将 `QVector` 转换为其他容器类型。

```cpp
QList<int> list = vec1.toList();  // 将 QVector 转为 QList
```

### 6. **常用函数总结**

- `append(T value)` / `push_back(T value)`：在末尾添加元素。
- `at(int i)`：返回指定索引处的元素。
- `size()`：返回当前元素数量。
- `capacity()`：返回当前预分配的内存大小。
- `clear()`：清空所有元素。
- `contains(T value)`：判断是否包含某个元素。
- `indexOf(T value)`：返回某个元素的索引。
- `removeAt(int i)`：删除指定位置的元素。
- `resize(int size)`：调整大小。

### 7. **QVector 使用示例**
下面是一个简单的示例，演示了 `QVector` 的基本用法。

```cpp
#include <QVector>
#include <QDebug>

int main() {
    QVector<int> vec;

    // 添加元素
    vec.append(1);
    vec.append(2);
    vec.append(3);

    // 访问元素
    qDebug() << "First element:" << vec.at(0);
    
    // 遍历元素
    for (int i = 0; i < vec.size(); ++i) {
        qDebug() << "Element at index" << i << ":" << vec[i];
    }

    // 查找和判断
    if (vec.contains(2)) {
        qDebug() << "Vector contains 2";
    }

    // 删除元素
    vec.removeAt(1);
    qDebug() << "After removing index 1:" << vec;

    return 0;
}
```

### 总结
`QVector` 是 Qt 提供的强大而灵活的动态数组容器，适用于需要高效存储和访问大量相同类型数据的场景。在日常使用中，可以充分利用其丰富的 API 和高性能特性来简化开发流程。