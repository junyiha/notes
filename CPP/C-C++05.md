## 概述 -- 理论基础知识

## 回调函数

### 1.1 概述

+ 回调函数，就是一个通过**函数指针**调用的函数。如果你把函数的指针（地址）作为参数传递给另一个函数，当这个指针被用来调用其所指向的函数时，我们就说这是回调函数。回调函数不是由该函数的实现方直接调用，而是在特定的事件或条件发生时由另外的一方调用的，用于对该事件或条件进行响应。 

+ 回调函数机制：
  + 定义一个函数（普通函数即可）
  + 将此函数的地址注册给调用者
  + 特定的事件或条件发生时，调用者使用函数指针调用回调函数
+ 注意：
  + 为什么要特定事件或条件发生？
  + 不应该随时都可以调用回调函数吗？
  + 可以把回调函数和调用函数封装承类再调用

### 1.2 函数指针

+ 概念：
  + 指针是一个变量，是用来指向内存地址的。
  + 一个程序运行时，所有和运行相关的物件都是需要加载到内存中，这就决定了程序运行时的任何物件都可以用指针来指向它。
  + 函数是存放在内存代码区域内的，它们同样有地址，因此同样可以用指针来存取函数，把这种**指向函数入口地址的指针**称为函数指针

```
  void Invoke(char* s);

  int main()
  {
      void (*fp)(char* s);    //声明一个函数指针(fp)        
      fp=Invoke;              //将Invoke函数的入口地址赋值给fp
      fp("Hello World!\n");   //函数指针fp实现函数调用
      return 0;
  }

  void Invoke(char* s)
  {
      printf(s);
  }
```
+ 由上可知：
  + 函数指针函数的声明之间唯一区别就是，用指针名`（*fp）`代替了函数名`Invoke`，这样这声明了一个函数指针，然后进行赋值`fp=Invoke`就可以进行函数指针的调用了。
  + 声明函数指针时，只要函数返回值类型、参数个数、参数类型等保持一致，就可以声明一个函数指针了。
  + 注意，函数指针必须用括号括起来 `void (*fp)(char* s)`

+ 实际中，为了方便，通常用宏定义的方式来声明函数指针，实现程序如下：
  ```
    typedef void (*FP)(char* s);
    void Invoke(char* s);

    int main(int argc,char* argv[])
    {
        FP fp;      //通常是用宏FP来声明一个函数指针fp
        fp=Invoke;
        fp("Hello World!\n");
        return 0;
    }

    void Invoke(char* s)
    {
        printf(s);
    }
  ``` 

### 1.3 回调函数 - 详解

+ 概念：
  + 回调函数，顾名思义，就是使用者自己定义一个函数，使用者自己实现这个函数的程序内容，然后把这个函数作为参数传入别人（或系统）的函数中，由别人（或系统）的函数在运行时来调用的函数。
  + 函数是你实现的，但由别人（或系统）的函数在运行时通过参数传递的方式调用，这就是所谓的回调函数。简单来说，就是由别人的函数运行期间来回调你实现的函数

+ 示例：
  + 标准Hello World程序：
    ```
      int main(int argc,char* argv[])
      {
          printf("Hello World!\n");
          return 0;
      }
    ``` 
  + 将它修改成函数回调样式：
    ```
      //定义回调函数
      void PrintfText() 
      {
          printf("Hello World!\n");
      }

      //定义实现回调函数的"调用函数"
      void CallPrintfText(void (*callfuct)())
      {
          callfuct();
      }

      //在main函数中实现函数回调
      int main(int argc,char* argv[])
      {
          CallPrintfText(PrintfText);
          return 0;
      }
    ```
  + 修改成带参的回调样式：
    ```
      //定义带参回调函数
      void PrintfText(char* s) 
      {
          printf(s);
      }

      //定义实现带参回调函数的"调用函数"
      void CallPrintfText(void (*callfuct)(char*),char* s)
      {
          callfuct(s);
      }

      //在main函数中实现带参的函数回调
      int main(int argc,char* argv[])
      {
          CallPrintfText(PrintfText,"Hello World!\n");
          return 0;
      }
    ``` 