---
category: Network
date: 2024-05-22 09:00:00 +0800
layout: post
title: 网络设备基础
tag: HTTP
---
## 简介

+ 常用的网络设备基础知识

## 网络交换机

+ 网络交换机(Network switch)是一种网络硬件，通过报文交换接收和转发数据到目标设备，它能够在计算机网络上连接不同的设备。一般也简称为交换机
+ 交换机是一种多端口的网桥，在数据链路层使用MAC地址转发数据。通过加入路由功能，一些交换机也可以在网络层转发数据，这种交换机一般被称为三层交换机或者多层交换机。
+ 以太网交换机是网络交换机最常见的形式。第一个以太网交换机由Kalpana公司（1994年被思科收购）推出。在其他类型的网络中，交换机也普遍存在，如光纤通道、异步传输模式和InfiniBand。
+ 中继器会在其所有端口转发相同的数据，让设备自行判断哪些是自己需要的数据，交换机则不同，它只会将数据转发到需要接收的设备

+ 工作原理
  + 交换机工作于OSI参考模型的第二层，即数据链路层。交换机内部的CPU会在每个端口成功连接时，通过将MAC地址和端口对应，形成一张MAC表。在今后的通讯中，发往该MAC地址的数据包将仅送往其对应的端口，而不是所有的端口。因此交换机可用于划分数据链路层广播，即冲突域；但它不能划分网络层广播，即广播域。
  + 交换机对数据包的转发是建立在MAC地址——物理地址基础之上的，对于IP网络协议来说，它是透明的，即交换机在转发数据包时，不知道也无须知道信源机和信宿机的IP地址，只需知其物理地址。
  + 交换机在操作过程当中会不断的收集资料去建立它本身的一个地址表，这个表相当简单，它说明了某个MAC地址是在哪个端口上被发现的，所以当交换机收到一个TCP/IP 数据包时，它便会查看该数据包的目的MAC地址，核对自己的地址表以确认应该从哪个端口把数据包发出去。由于这个过程比较简单，加上这功能由一崭新硬件进行——ASIC，因此速度相当快。一般只需几十微秒，交换机便可决定一个IP数据包该往哪里送
  + 如果目的地MAC地址不能在地址表中找到时，交换机会把IP 数据包“扩散”出去，即把它从每一个端口中提交去，就如交换机在处理一个收到的广播数据包时一样。二层交换机的弱点正是它处理广播数据包的手法不太有效，比方说，当一个交换机收到一个从TCP/IP工作站上发出来的广播数据包时，他便会把该数据包传到所有其他端口去，哪怕有些端口上连的是IPX或DECnet工作站。这样一来，非TCP/IP节点的带宽便会受到负面的影响，就算同样的TCP/IP节点，如果他们的子网跟发送那个广播数据包的工作站的子网相同，那么他们也会无缘无故地收到一些与他们毫不相干的网络广播，整个网络的效率因此会大打折扣

+ 工作方式
  + 收到某网段（设为A）MAC地址为X的计算机发给MAC地址为Y的计算机的数据包。交换机从而记下了MAC地址X在网段A。这称为学习（learning）。
  + 交换机还不知道MAC地址Y在哪个网段上，于是向除了A以外的所有网段转发该数据包。这称为泛洪（flooding）。
  + MAC地址Y的计算机收到该数据包，向MAC地址X发出确认包。交换机收到该包后，从而记录下MAC地址Y所在的网段
  + 交换机向MAC地址X转发确认包。这称为转发（forwarding）
  + 交换机收到一个数据包，查表后发现该数据包的来源地址与目的地址属于同一网段。交换机将不处理该数据包。这称为过滤（filtering）
  + 交换机内部的MAC地址-网段查询表的每条记录采用时间戳记录最后一次访问的时间。早于某个阈值（用户可配置）的记录被清除。这称为老化（aging）。
+ 对于全交换（full-switch）局域网，交换机每个端口只连接一台设备，因此不会发生碰撞。交换机也不需要做过滤

+ 工作在OSI不同层级的交换技术
+ 现代商业交换机主要使用以太网接口。提供多端口的二层桥接是以太网交换机的核心功能，而很多交换机也提供其他层级的服务，这种不仅仅提供了桥接功能的交换机也被称为多层交换机。多层交换机可以在许多层级上学习拓扑结构，也可以在一层或多层上进行转发。
+ 一层
  + 一层网络设备传输数据而不控制任何流量，比如集线器。任何进入端口数据包会被转发到除进入端口之外的其他所有端口。具体而言，即每个比特或码元被转发时是原封不动的。由于每个数据包被分发到所有端口，其冲突会影响到整个网络，进而限制了它的整体的能力。 到21世纪初，集线器和低端交换机的价格差异很小。[1]对于特定应用，集线器在一段时间内还是能够发挥作用的，比如给数据包分析器提供网络流量的副本。网络分流器还有交换机的端口镜像也可以实现同样功能
+ 二层
  + 二层交换机依据硬件地址（MAC 地址）在数据链路层（第二层）传送网络帧。 二层交换机对于路由器和主机是“透明的”，主要遵从802.1d 标准。该标准规定交换机通过观察每个端口的数据帧获得源MAC 地址，交换机在内部的高速缓存中建立MAC 地址与端口的映射表。当交换机接受的数据帧的目的地址在该映射表中被查到，交换机便将该数据帧送往对应的端口。如果它查不到，便将该数据帧广播到该端口所属虚拟局域网（VLAN）的所有端口，如果有回应数据包，交换机便将在映射表中增加新的对应关系。当交换机初次加入网络中时，由于映射表是空的，所以，所有的数据帧将发往虚拟局域网内的全部端口直到交换机“学习”到各个MAC 地址为止。这样看来，交换机刚刚启动时与传统的共享式集线器作用相似的，直到映射表建立起来后，才能真正发挥它的性能。这种方式改变了共享式以太网抢行的方式，如同在不同的行驶方向上铺架了立交桥，去往不同方向的车可以同时通行，因此大大提高了流量。从VLAN的角度来看，由于只有子网内部的节点竞争带宽，所以性能得到提高。主机1 访问主机2 同时，主机3 可以访问主机4 。当各个部门具有自己独立的服务器时，这一优势更加明显。但是这种环境正发生巨大的变化，因为服务器趋向于集中管理，另外，这一模式也不适合Internet的应用。不同VLAN之间的通讯需要通过路由器来完成，另外为了实现不同的网段之间通讯也需要路由器进行互连。
+ 三层 
  + 三层交换机则可以处理第三层网络层协议，用于连接不同网段，通过对缺省网关的查询学习来建立两个网段之间的直接连接
  + 三层交换机可以实现路由器的全部或部分功能，但只能用于同一类型的局域网子网之间的互连。这样，三层交换机可以像二层交换机那样通过MAC地址标识数据包，也可以像传统路由器那样在两个局域网子网之间进行功能较弱的路由转发，它的路由转发不是通过软件来维护的路由表，而是通过专用的ASIC芯片处理这些转发；
+ 四层
  + 四层交换机可以处理第四层传输层协议，可以将会话与一个具体的IP地址绑定，以实现虚拟IP 
+ 七层
  + 更加智能的交换器，可以充分利用频宽资源来过滤，识别和处理应用层数据转换的交换设备

+ 网络交换机带宽分为： 10Mb/s、100Mb/s、1Gb/s、10Gb/s、40Gb/s、100Gb/s。Mbps换算MB/s：1Mbps=0.125MB/s。

## 路由器

+ 路由器(Router)是将运算设备（例如电脑）及网络连线至其他网络的联网设备。路由器有三个主要功能，分别是
  + 确定路径：路由器可以决定从来源到目的地所采用的路径，这个作业称为路由。
  + 资料转传：路由器会将资料转传至所选路径的下一个设备，重复这个过程，最终资料可以抵达目的地。运算设备和路由器可能位于相同的网络或不同的网络。
  + 负载平衡：路由器有时会用多个不同路径，发送相同资料报文副本。其目的是为了减少因资料丢失而造成错误、并建立备援及管理流量。
+ 比较技术性的解释是路由器是种电信网络设备，提供路由与转送两种重要机制，
  + 可以决定报文由来源端到目的端所经过的路径（host到host之间的传输路径），这个过程称为路由；
  + 将路由器输入端的报文移送至适当的路由器输出端（在路由器内部进行），这称为转送。
+ 路由工作在OSI模型的第三层——即网络层，例如网际协议（IP）。

+ 路由器可连接两个以上个别网络的设备。
+ 由于位于两个或更多个网络的交汇处，从而可在它们之间传递分组（一种数据的组织形式）。路由器与交换机在概念上有一定重叠但也有不同：
  + 交换机泛指工作于任何网络层次的数据中继设备（尽管多指网桥），
  + 而路由器则更专注于网络层

+ 路由器与交换机有四个主要差别
  + 第一，路由器是OSI第三层的产品，而交換机则是第二层，第二层主要功能是将网络上各个电脑的MAC地址记在MAC地址表中，当局域网中的电脑要经过交換机去交换传递资料时，就查询交換机上的MAC地址表中的信息，并将报文发送给指定的电脑，而不会像第一层的产品（如集线器）发送给每台在网络中的电脑。
  + 第二，路由器能在多条路径中选择最佳的路径，提升交换数据的传输速率。在发送报文时，路由表会被一同发送，该表存储了前往某一网络的最佳路径，如该路径的“路由度量值”，参考路由表可获得这个过程的详细描述。
  + 第三，路由器可连接超过两个以上不同的网络，而交換机只能连接两个。
  + 第四，路由器具有IP分享器功能，主要是让多台设备用同一条ADSL/光纤宽带线路来上网，功能包括共享IP，宽带管理，自动分配IP等等，如在共享IP功能中，不同设备可共享同一个公共IP同时上网；在局域网中，路由器则会指定一组的Class C的私有IP，可让254台设备同时上网。

+ 路由器的种类
  + 边缘路由器(edge router)
    + 将设备连接到互联网的路由器。
  + 核心路由器
    + 如在ISP网络中，只负责与其他路由器之间传递数据
  + 单臂路由器(one-armed-router)
    + 一种特殊类型的路由器，可用来在多个虚拟局域网（Virtual LAN）之间传递数据包
    + 在无线ad-hoc网络中的每台主机自己进行路由和数据转发，而在有线网络中通常一个广播域就有一台路由器。
    + 近来，许多路由的功能被加入到局域网交换机（实质是高速网桥）上，从而创造出“三层交换机”，可以以接近线速的速度来转发流量。
    + 路由器也被当作Internet网关，主要用在小型网络中如家庭或小型办公室。这种设备使用的Internet连接往往是互联网宽带连接如线缆调制解调器和DSL。这种路由器连接两个网络，WAN和LAN并有自己的路由表。尽管在家庭应用中并不需要太多路由功能（因为只存在WAN和LAN），但这些小型路由器仍然支持路由信息协议。额外地，这种路由器还支持DHCP、网络地址转换、DMZ和防火墙功能，也有一些支持内容过滤和VPN。通常这种路由器和线缆或DSL调制解调器协同工作，但调制解调功能也可以内置在这种路由器中。这种路由器往往同时具有阻止特定外部请求的安全特性。
    + 大型的路由器一般安装在数据中心、电信公司或ISP的机房内。这些路由器将许多网络用大量的带宽连接起来。根据分工的不同，这些路由器可以支持路由协议中的几种，包括IS-IS、OSPF、IGRP、EIGRP、RIP、BGP。
  + 无线网络路由器
    + 无线网络路由器是一种用来连系有线和无线网络的通讯设备，它可以通过无线方式（如，Wi-Fi）连接终端设备（如，手机、笔记本电脑），进而建立计算机网络。
    + 有的电信运营商为客户安装宽带时会提供含有Wi-Fi的路由器，通过简单地设置拨号可以实现宽带的共享。
    + 无线方式较有线方式更易受环境影响。如，在户外使用无线，其速度可能受天气影响。
    + 其它的无线方式有：红外线、蓝牙、卫星微波等
  + 策略路由
    + 策略路由比常规路由更灵活，常规路由基于目标网络进行的数据包转发，策略路由则额外定义数据转发规则，包含策略与操作（路由图），如会检查该接口接收到的所有数据包，是否符合路由图中的策略。对不符合的进行处理；符合的则按路由图策略中，对应的操作进行处理

## 网关

+ 网关(Gateway)是计算机网络中的一种设备或服务器，用于连接不同网络或协议之间进行数据转发和处理。
+ 网关是一种能够在不同网络或协议之间进行数据交换的设备或服务器。网关可以实现不同网络之间的互联互通，也可以实现不同协议之间的转换和适配。网关可以根据不同的功能和层次进行分类，例如物理层网关、数据链路层网关、网络层网关、传输层网关、应用层网关等[1]。网关可以提供多种服务，例如路由、安全、负载均衡、缓存、压缩、加密、认证、授权、过滤、转码等

+ 网关的工作机制
  + 网关的工作机制与代理非常相似，它能够接收客户端的请求，并像拥有资源的源服务器一样对请求进行处理或转发。客户端可能无法察觉到通信目标是一个网关，而不是一个源服务器。网关可以根据不同的需求，对请求和响应进行不同的处理，例如修改请求头或响应头，改变请求方法或响应状态码，增加或删除请求参数或响应内容等[3]。网关还可以根据不同的协议，对数据进行编码或解码，例如将HTTP协议转换成FTP协议，或将TCP协议转换成UDP协议等。

+ 应用场景
  + 家庭或小型企业网络中的网关：这种网关通常用于连接局域网和互联网，实现内外网的通信。它可以提供路由、防火墙、NAT、DHCP等功能，保证网络的安全和稳定。
  + 物联网中的智能网关：这种网关用于连接物联网设备和云端平台，实现数据的采集、处理和传输。它可以提供协议转换、数据压缩、数据分析、数据安全等功能，提高物联网系统的性能和效率
  + 语音通信中的语音网关：这种网关用于连接传统电话网络和IP网络，实现语音信号的转换和传输。它可以提供模拟/数字信号转换、编解码器选择、信令协商等功能，保证语音通信的质量和兼容性